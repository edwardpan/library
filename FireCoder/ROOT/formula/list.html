<!DOCTYPE HTML>
<html>
  <head>
    
    <title>公式配置界面</title>
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="cache-control" content="no-cache">
	<meta http-equiv="expires" content="0">    
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<style type="text/css" title="currentStyle">
			@import "../jq/datatables/css/page.css";
			@import "../jq/datatables/css/table.css";
			@import "../jq/datatables/css/table_jui.css";
			@import "../jq/validation/css/validation.css";
			@import "../jq/jalert/css/jquery.alerts.css";
			@import "../jq/css/start/jquery-ui-1.8.14.custom.css";
	</style>
	<script type="text/javascript" src="../js/KeyTable.js"></script>
	<script type="text/javascript" src="../jq/jquery-1.6.2.min.js"></script>
	<script type="text/javascript" src="../jq/jalert/jquery.alerts.js"></script>
	<script type="text/javascript" src="../jq/datatables/jquery.dataTables.min.js"></script>
	<script type="text/javascript" src="../jq/datatables/jquery.dataTables.editable.js"></script>
	<script type="text/javascript" src="../jq/jeditable/jquery.jeditable.mini.js"></script>
	<script type="text/javascript" src="../jq/validation/jquery.validate.min.js"></script>
	<script type="text/javascript" src="../jq/ui/jquery-ui-1.8.14.custom.min.js"></script>
	<script type="text/javascript" src="../jq/ui/i18n/jquery.ui.datepicker-zh-CN.js"></script>
	<script type="text/javascript" src="https://getfirebug.com/firebug-lite.js"></script>
	<script type="text/javascript">
	$.ajaxSetup({cache:false,type:"POST"});
	var dataGrid = null;
	var elDataGrid = null;
	$(document).ready(function(){
		var id = -1;
		dataGrid = $('#dataGrid').dataTable( {
			"oLanguage": {//汉化  
                "sLengthMenu": "每页显示 _MENU_ 条记录",
                "sZeroRecords": "没有检索到数据",
                "sInfo": "当前数据为从第 _START_ 到第 _END_ 条数据；总共有 _TOTAL_ 条记录",
                "sSearch": "搜索",
                "sInfoFiltered": "(从 _MAX_ 条数据中过滤)",
                "sInfoEmtpy": "没有数据",
                "sProcessing": "正在加载数据...",
                "oPaginate": {
                    "sFirst": "首页",
                    "sPrevious": "前页",
                    "sNext": "后页",
                    "sLast": "尾页"
                }
            },
			"bJQueryUI": true,
			"bPaginate": true,
			//"bFilter": false,
			//"bLengthChange": true,
			"bSort": false,
			"bAutoWidth": false,
			"bProcessing": true,
			"bServerSide": true,
			"sPaginationType": "full_numbers",
			"sAjaxSource": "list",
			"sAjaxDataProp": "page.items",
			/*"fnServerData": function ( sSource, aoData, fnCallback ) {
				$.getJSON(sSource, aoData, function(data){
					$.each(data.page.items, function(item){
						
					});
				});
			},*/
			"aoColumns": [
				{ "sName":"id", "mDataProp":"id", "bVisible":false },
				{ "sName":"expression", "mDataProp":"expression", "sWidth":"60%" },
				{ "sName":"isSetScale", "mDataProp":"isSetScale", "sWidth":"10%" },
				{ "sName":"scale", "mDataProp":"scale", "sType":"numeric", "sWidth":"10%" },
				{ "sName":"resultUnit", "mDataProp":"resultUnit", "sWidth":"20%" }
			]
		} ).makeEditable({
			sAddURL: "add",
			sUpdateURL: "modifyValue",
			sDeleteURL: "delete",
			/*fnOnAdded: function(status){
				//jAlert("增加计算公式完成. 状态 - " + status, "增加完成");
				if (status == "success"){
					$("#lblError").append("增加计算公式成功");
				} else if (status == "failure"){
					$("#lblError").append("增加计算公式失败");
				}
				$("#lblError").show();
				dataGrid.fnDraw();
			},
			fnOnEdited: function(status){ 	
				if (status == "success"){
					$("#lblError").append("编辑成功");
				} else if (status == "failure"){
					$("#lblError").append("编辑失败");
				}
				$("#lblError").show();
				dataGrid.fnDraw();
			},
			fnOnDeleted: function(status){
				if (status == "success"){
					$("#lblError").append("删除成功");
				} else if (status == "failure"){
					$("#lblError").append("删除失败");
				}
				$("#lblError").show();
				dataGrid.fnDraw();
			},*/
			fnOnDeleting: function(tr, id, fnDeleteRow) {
	            return confirm("确认删除该数据？"); ;
	        },
			"aoColumns": [
				{
					indicator:'保存算术公式...',
					tooltip:'点击修改算术公式',
					type:'text',
					cssclass:'required',
					submit:'保存',
					maxlength:1000},
				{
					indicator:'保存是否取精度设置...',
					tooltip:'点击设置是否对计算结果取精度',
					loadtext:'加载...',
					cssclass:'required',
					type:'select',
					onblur:'submit',
					data:"{'Y':'是','N':'否'}"},
				{
					indicator:'保存精度长度设置...',
					tooltip:'点击设置精度长度（保留的小数位）',
					loadtext:'加载...',
					cssclass:'required number',
					type:'select',
					onblur:'submit',
					data:"{'0':'0','1':'1','2':'2','3':'3','4':'4','5':'5','6':'6','7':'7','8':'8','9':'9','10':'10'}"},
				{
					indicator:'保存结果单位设置...',
					tooltip:'点击设置显示结果使用的单位',
					loadtext:'加载...',
					type:'text',
					submit:'保存',
					maxlength:100,
					placeholder:"点击编辑" }
			],
			sAddDeleteToolbarSelector: ".dataTables_length",
			sAddNewRowButtonId: "addFormulaBtn",
			sDeleteRowButtonId: "delFormulaBtn",
			sAddNewRowFormId: "addFormulaForm",
			sAddNewRowOkButtonId: "addFormulaOkBtn",
			sAddNewRowCancelButtonId: "addFormulaCancelBtn",
			oAddNewRowButtonOptions: { 
				label: "增加...",
				icons: { primary: 'ui-icon-plus' }
			},
			oDeleteRowButtonOptions: {
				label: "删除",
				icons: { primary: 'ui-icon-trash' }
			},
			oAddNewRowOkButtonOptions: {
				label: "确认",
				icons: { primary: 'ui-icon-check' },
				name: "action",
				value: "add-new"
			},
			oAddNewRowCancelButtonOptions: { 
				label: "关闭",
				"class": "back-class",
				name: "action",
				value: "cancel-add",
				icons: { primary: 'ui-icon-close' }
			},
			oAddNewRowFormOptions: {
				title: '添加新的计算元素',
				show: "blind",
				hide: "blind",
				width: 600
			}
		});
		elDataGrid = $("#elDataGrid").dataTable({
			"oLanguage": {//汉化  
                "sLengthMenu": "每页显示 _MENU_ 条记录",
                "sZeroRecords": "",
                "sInfo": "当前数据为从第 _START_ 到第 _END_ 条数据；总共有 _TOTAL_ 条记录",
                "sSearch": "搜索",
                "sInfoFiltered": "(从 _MAX_ 条数据中过滤)",
                "sInfoEmtpy": "没有数据",
                "sProcessing": "正在加载数据...",
                "oPaginate": {
                    "sFirst": "首页",
                    "sPrevious": "前页",
                    "sNext": "后页",
                    "sLast": "尾页"
                }
            },
			"bJQueryUI": true,
			"bPaginate": false,
			"bLengthChange": false,
			"bInfo": false,
			"bFilter": false,
			"bAutoWidth": false,
			"bSort": false,
			"aoColumns": [
				{ "sWidth":"10%" },
				{ "sWidth":"15%" },
				{ "sWidth":"15%" },
				{ "sWidth":"10%" },
				{ "sWidth":"10%" },
				{ "sWidth":"10%" },
				{ "sWidth":"15%" },
				{ "sWidth":"15%" }
			]
		}).makeEditable({
			//sUpdateURL: "modifyElement",
			sAddURL: function(value, settings){
				value = "";
				elDataGrid.fnAddData( [
					"1",
					"2",
					"3",
					"4",
					"5",
					"6",
					"7",
					"8"] );
                return(value);
			},
			//sDeleteURL: "deleteElement",
			sAddDeleteToolbarSelector: ".dataTables_length",
			sAddNewRowButtonId: "addFormulaElBtn",
			sDeleteRowButtonId: "delFormulaElBtn",
			sAddNewRowFormId: "addFormulaElForm",
			sAddNewRowOkButtonId: "addFormulaElOkBtn",
			sAddNewRowCancelButtonId: "addFormulaElCancelBtn",
			oAddNewRowButtonOptions: {
				label: "增加...",
				icons: { primary: 'ui-icon-plus' }
			},
			oDeleteRowButtonOptions: {
				label: "删除",
				icons: { primary: 'ui-icon-trash' }
			},
			oAddNewRowOkButtonOptions: {
				label: "确认",
				icons: { primary: 'ui-icon-check' },
				name: "action",
				value: "add-new"
			},
			oAddNewRowCancelButtonOptions: { 
				label: "关闭",
				"class": "back-class",
				name: "action",
				value: "cancel-add",
				icons: { primary: 'ui-icon-close' }
			},
			oAddNewRowFormOptions: {
				title: '添加新的计算元素',
				show: "blind",
				hide: "blind"
			}
		});
	});
	</script>
	<style type="text/css">
	body{
		font-size:12px;
	}
	</style>
  </head>
  
  <body>
  	<label id="lblError" style="display:none" class="error"></label>
  	<div>
	    <input type="button" id="addFormulaBtn"/>
		<input type="button" id="delFormulaBtn"/>
  	</div>
	<table id="dataGrid" width="100%">
		<thead>
			<tr>
				<td>编号</td>
				<td>算术公式</td>
				<td>是否取精度</td>
				<td>精度大小</td>
				<td>结果单位</td>
			</tr>
		</thead>
		<tbody>
		</tbody>
	</table>
	<form id="addFormulaForm" action="#">
		<table border="0" cellpadding="0" cellspacing="0">
			<tr>
				<td>算术公式：</td>
				<td><input type="text" id="expression" name="expression" value=""/></td>
			</tr>
			<tr>
				<td>结果是否取精度：</td>
				<td><select name="isSetScale" id="isSetScale">
					<option value="Y">是</option>
					<option value="N">否</option>
				</select></td>
			</tr>
			<tr>
				<td>精度长度：</td>
				<td><input type="text" id="scale" name="scale" value=""/></td>
			</tr>
			<tr>
				<td>结果单位：</td>
				<td><input type="text" id="resultUnit" name="resultUnit" value=""/></td>
			</tr>
		</table>
		<br/>
		<div>
			<input type="button" id="addFormulaElBtn"/>
			<input type="button" id="delFormulaElBtn"/>
		</div>
		<table id="elDataGrid">
			<thead>
				<tr>
					<td>代入元素</td>
					<td>默认值</td>
					<td>元素单位</td>
					<td>数据类别</td>
					<td>是否可编辑</td>
					<td>是否标准值</td>
					<td>可填最小范围</td>
					<td>可填最大范围</td>
				</tr>
			</thead>
			<tbody>
			</tbody>
		</table>
		<div align="right">
			<button id="addFormulaOkBtn"></button>
			<button id="addFormulaCancelBtn"></button>
		</div>
	</form>
	<form id="addFormulaElForm" action="#">
		<table border="0" cellpadding="0" cellspacing="0">
			<thead>
				<tr>
					<td>代入元素</td>
					<td><input type="text" id="name" name="name" value=""/></td>
				</tr>
				<tr>
					<td>默认值</td>
					<td><input type="text" id="value" name="value" value=""/></td>
				</tr>
				<tr>
					<td>元素单位</td>
					<td><input type="text" id="valueUnit" name="valueUnit" value=""/></td>
				</tr>
				<tr>
					<td>数据类别</td>
					<td><input type="text" id="dataType" name="dataType" value=""/></td>
				</tr>
				<tr>
					<td>是否可编辑</td>
					<td><select name="writable" id="writable">
					<option value="Y">是</option>
					<option value="N">否</option>
				</select></td>
				</tr>
				<tr>
					<td>是否标准值</td>
					<td><select name="isFinal" id="isFinal">
					<option value="N">否</option>
					<option value="Y">是</option>
				</select></td>
				</tr>
				<tr>
					<td>可填最小范围</td>
					<td><input type="text" id="minVal" name="minVal" value=""/></td>
				</tr>
				<tr>
					<td>可填最大范围</td>
					<td><input type="text" id="maxVal" name="maxVal" value=""/></td>
				</tr>
			</thead>
			<tbody>
			</tbody>
		</table>
		<div align="right">
			<button id="addFormulaElOkBtn"></button>
			<button id="addFormulaElCancelBtn"></button>
		</div>
	</form>
  </body>
</html>
